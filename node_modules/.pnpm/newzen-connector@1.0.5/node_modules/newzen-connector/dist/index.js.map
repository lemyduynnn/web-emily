{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { NEWGEN_MESSAGE } from \"./constants\";\r\n\r\ninterface IFunction {\r\n  (...args: any[]): any;\r\n}\r\n\r\nexport default class NewzenConnector {\r\n\r\n  _formattedPage = null;\r\n  callback: IFunction;\r\n\r\n  constructor({ callback, initialData }: { callback: IFunction, initialData: any }) {\r\n    // this.actionHandler();\r\n    this.callback = callback;\r\n    this._formattedPage = initialData ?? null;\r\n  }\r\n  \r\n  actionHandler = () => {\r\n    const createButton = (text: string, dataCmsBind: any) => {\r\n      const button = document.createElement('div');\r\n      button.textContent = text;\r\n      button.addEventListener('click', () => {\r\n        const messageType = `newzen:template:${text.toLowerCase()}Block`;\r\n        window.parent.postMessage({ type: messageType, data: dataCmsBind }, '*');\r\n      });\r\n      return button;\r\n    };\r\n    const createBlockNavigator = (section: HTMLDivElement) => {\r\n      const div = document.createElement('div');\r\n      if (this._formattedPage) {\r\n        div.classList.add('block-navigator');\r\n        const buttons = ['Edit', 'Up', 'Down', 'Delete'];\r\n        buttons.forEach((buttonText) => {\r\n          const button = createButton(buttonText, section.dataset.cmsBind);\r\n          div.appendChild(button);\r\n        });\r\n      }\r\n      return div;\r\n    };\r\n    const handleMouseEvents = (event: any, isMouseOver: boolean) => {\r\n      const section = event.target.closest('[data-cms-bind^=\"#content_blocks\"]');\r\n      if (!section) {\r\n        return\r\n      }\r\n      section.classList.toggle('content-block--hover', isMouseOver);\r\n      if (window.location !== window.parent.location) {\r\n        // The page is in an iFrames\r\n        section.classList.remove('hidden-block-navigator')\r\n      } else {\r\n        // The page is not in an iFrame\r\n        section.classList.add('hidden-block-navigator')\r\n      }\r\n      const nav = section.querySelector('.block-navigator');\r\n      if (nav?.contains(event.relatedTarget)) {\r\n        return\r\n      }\r\n      if (isMouseOver && !nav) {\r\n        section.appendChild(createBlockNavigator(section));\r\n        return;\r\n      }\r\n      if (!isMouseOver && nav) {\r\n        section.removeChild(nav);\r\n      }\r\n    };\r\n    document.body.addEventListener('mouseover', (event: any) => handleMouseEvents(event, true));\r\n    document.body.addEventListener('mouseout', (event: any) => handleMouseEvents(event, false));\r\n    window.addEventListener('message', (event) => {\r\n      const { type, data } = event.data;\r\n      switch (type) {\r\n        case NEWGEN_MESSAGE.TEMPLATE_SCROLL_TO_SECTION: {\r\n          const div = document.querySelector(`[data-cms-bind=\"#content_blocks.${data - 1}\"]`) as HTMLDivElement;\r\n          if (!div) {\r\n            return\r\n          }\r\n          const divOffset = div.offsetTop;\r\n          const offset = (document.querySelector('header[class*=\"sticky\"]') as HTMLDivElement).offsetHeight || 0;\r\n          window.scrollTo({ top: divOffset - offset, behavior: 'smooth' });\r\n          break;\r\n        }\r\n        case NEWGEN_MESSAGE.UPDATE: {\r\n          this._formattedPage = NewzenConnector.formatContentBlock(JSON.parse(data));\r\n          this.callback!(this._formattedPage);\r\n          break;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  static formatContentBlock = (pageObject: any) => {\r\n    pageObject.content_blocks.forEach(function (item: any) {\r\n      item._block_name = item._block_name\r\n        .replaceAll(/[^a-zA-Z0-9 ]/g, ' ')\r\n        .replaceAll(/(^\\w)|(\\s+\\w)/g, (c: string) => c.toUpperCase())\r\n        .replaceAll(' ', '');\r\n    });\r\n    return pageObject;\r\n  };\r\n}\r\n"],"mappings":"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","names":[]}