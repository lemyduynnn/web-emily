{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import { NEWGEN_MESSAGE } from \"./constants\";\r\n\r\ninterface IFunction {\r\n  (...args: any[]): any;\r\n}\r\n\r\nexport default class NewzenConnector {\r\n\r\n  _formattedPage = null;\r\n  callback: IFunction;\r\n\r\n  constructor({ callback, initialData }: { callback: IFunction, initialData: any }) {\r\n    // this.actionHandler();\r\n    this.callback = callback;\r\n    this._formattedPage = initialData ?? null;\r\n  }\r\n\r\n  actionHandler = () => {\r\n    const createButton = (text: string, dataCmsBind: any) => {\r\n      const button = document.createElement('div');\r\n      button.textContent = text;\r\n      button.addEventListener('click', () => {\r\n        const messageType = `newzen:template:${text.toLowerCase()}Block`;\r\n        window.parent.postMessage({ type: messageType, data: dataCmsBind }, '*');\r\n      });\r\n      return button;\r\n    };\r\n    const createBlockNavigator = (section: HTMLDivElement) => {\r\n      const div = document.createElement('div');\r\n      if (this._formattedPage) {\r\n        div.classList.add('block-navigator');\r\n        const buttons = ['Edit', 'Up', 'Down', 'Delete'];\r\n        buttons.forEach((buttonText) => {\r\n          const button = createButton(buttonText, section.dataset.cmsBind);\r\n          div.appendChild(button);\r\n        });\r\n      }\r\n      return div;\r\n    };\r\n    const handleMouseEvents = (event: any, isMouseOver: boolean) => {\r\n      const section = event.target.closest('[data-cms-bind^=\"#content_blocks\"]');\r\n      if (!section) {\r\n        return\r\n      }\r\n      section.classList.toggle('content-block--hover', isMouseOver);\r\n      if (window.location !== window.parent.location) {\r\n        // The page is in an iFrames\r\n        section.classList.remove('hidden-block-navigator')\r\n      } else {\r\n        // The page is not in an iFrame\r\n        section.classList.add('hidden-block-navigator')\r\n      }\r\n      const nav = section.querySelector('.block-navigator');\r\n      if (nav?.contains(event.relatedTarget)) {\r\n        return\r\n      }\r\n      if (isMouseOver && !nav) {\r\n        section.appendChild(createBlockNavigator(section));\r\n        return;\r\n      }\r\n      if (!isMouseOver && nav) {\r\n        section.removeChild(nav);\r\n      }\r\n    };\r\n    document.body.addEventListener('mouseover', (event: any) => handleMouseEvents(event, true));\r\n    document.body.addEventListener('mouseout', (event: any) => handleMouseEvents(event, false));\r\n    window.addEventListener('message', (event) => {\r\n      const { type, data } = event.data;\r\n      switch (type) {\r\n        case NEWGEN_MESSAGE.TEMPLATE_SCROLL_TO_SECTION: {\r\n          const div = document.querySelector(`[data-cms-bind=\"#content_blocks.${data - 1}\"]`) as HTMLDivElement;\r\n          if (!div) {\r\n            return\r\n          }\r\n          const divOffset = div.offsetTop;\r\n          const offset = (document.querySelector('header[class*=\"sticky\"]') as HTMLDivElement).offsetHeight || 0;\r\n          window.scrollTo({ top: divOffset - offset, behavior: 'smooth' });\r\n          break;\r\n        }\r\n        case NEWGEN_MESSAGE.UPDATE: {\r\n          this._formattedPage = NewzenConnector.formatContentBlock(JSON.parse(data));\r\n          this.callback!(this._formattedPage);\r\n          break;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  static formatContentBlock = (pageObject: any) => {\r\n    pageObject.content_blocks.forEach(function (item: any) {\r\n      item._block_name = item._block_name\r\n        .replaceAll(/[^a-zA-Z0-9 ]/g, ' ')\r\n        .replaceAll(/(^\\w)|(\\s+\\w)/g, (c: string) => c.toUpperCase())\r\n        .replaceAll(' ', '');\r\n    });\r\n    return pageObject;\r\n  };\r\n}\r\n"],"mappings":"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","names":[]}